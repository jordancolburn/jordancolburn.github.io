<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Cops & Robbers Typing Chase</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      min-height: 100vh;
      background: linear-gradient(to bottom, #1a1a2e 0%, #16213e 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
    }

    /* --- SCENE --- */
    .scene {
      width: 100%;
      max-width: 700px;
      height: 200px;
      position: relative;
      background: linear-gradient(to bottom, #2d3a5c 0%, #1a2744 60%, #3a3a3a 60%, #4a4a4a 100%);
      border-bottom: 6px solid #FFD700;
      overflow: hidden;
      margin-top: 10px;
      border-radius: 12px 12px 0 0;
    }
    /* road lines */
    .road-lines {
      position: absolute;
      bottom: 36px;
      left: 0; right: 0;
      height: 4px;
      display: flex;
      gap: 30px;
      animation: roadScroll 1s linear infinite;
      animation-play-state: paused;
    }
    .road-lines.running { animation-play-state: running; }
    .road-lines span {
      display: block;
      width: 40px;
      height: 4px;
      background: #FFD700;
      border-radius: 2px;
      flex-shrink: 0;
    }
    @keyframes roadScroll {
      from { transform: translateX(0); }
      to { transform: translateX(-70px); }
    }

    /* buildings */
    .buildings {
      position: absolute;
      bottom: 60px;
      left: 0; right: 0;
      display: flex;
      gap: 8px;
      padding: 0 10px;
    }
    .building {
      width: 40px;
      border-radius: 3px 3px 0 0;
      flex-shrink: 0;
    }

    /* characters */
    .char {
      position: absolute;
      bottom: 16px;
      font-size: 48px;
      transition: left 0.4s ease-out;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,0.5));
    }
    .cop { left: 10%; }
    .robber { left: 75%; }
    .char .label {
      position: absolute;
      top: -22px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      font-weight: 700;
      color: #fff;
      background: rgba(0,0,0,0.5);
      padding: 2px 8px;
      border-radius: 8px;
      white-space: nowrap;
    }

    /* siren flash */
    .siren {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s;
    }
    .siren.flash-red { background: rgba(255, 0, 0, 0.06); opacity: 1; }
    .siren.flash-blue { background: rgba(0, 100, 255, 0.06); opacity: 1; }

    /* --- GAP METER --- */
    .meter-area {
      width: 100%;
      max-width: 700px;
      padding: 8px 16px;
      background: #16213e;
    }
    .meter-label {
      font-size: 13px;
      color: #aab;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
    }
    .meter-bar {
      width: 100%;
      height: 14px;
      background: #2a2a4a;
      border-radius: 7px;
      overflow: hidden;
    }
    .meter-fill {
      height: 100%;
      background: linear-gradient(90deg, #7ED957, #56C1FF);
      border-radius: 7px;
      transition: width 0.4s ease-out;
      width: 0%;
    }

    /* --- GAME AREA --- */
    .game-area {
      width: 100%;
      max-width: 700px;
      background: #0f1a30;
      padding: 20px 20px 16px;
      border-radius: 0 0 12px 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .stats {
      display: flex;
      gap: 20px;
      margin-bottom: 14px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .stat {
      font-size: 15px;
      color: #8899bb;
      font-weight: 600;
    }
    .stat b { color: #fff; font-size: 18px; }

    .word-display {
      font-size: 42px;
      font-weight: 800;
      letter-spacing: 4px;
      margin-bottom: 12px;
      min-height: 55px;
      display: flex;
      gap: 2px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .word-display .letter {
      color: #445;
      transition: color 0.1s;
    }
    .word-display .letter.typed { color: #7ED957; }
    .word-display .letter.current { color: #FFD700; text-decoration: underline; }
    .word-display .letter.error { color: #FF6B6B; }

    .input-area {
      width: 100%;
      max-width: 400px;
      position: relative;
    }
    .type-input {
      width: 100%;
      font-size: 28px;
      font-weight: 700;
      text-align: center;
      padding: 12px 16px;
      border: 3px solid rgba(255,255,255,0.12);
      border-radius: 16px;
      background: rgba(255,255,255,0.06);
      color: #fff;
      outline: none;
      letter-spacing: 3px;
      caret-color: #FFD700;
      transition: border-color 0.2s;
    }
    .type-input:focus { border-color: #56C1FF; }
    .type-input.error-flash { border-color: #FF6B6B; }

    .message {
      margin-top: 14px;
      font-size: 18px;
      font-weight: 700;
      min-height: 28px;
      text-align: center;
    }
    .message.good { color: #7ED957; }
    .message.great { color: #FFD700; }
    .message.miss { color: #FF6B6B; }

    /* --- SCREENS --- */
    .overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(10, 14, 30, 0.92);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .overlay.hidden { display: none; }
    .overlay h1 {
      font-size: 48px;
      color: #FFD700;
      text-shadow: 0 4px 20px rgba(255,215,0,0.3);
      margin-bottom: 8px;
    }
    .overlay .subtitle {
      font-size: 22px;
      color: #aab;
      margin-bottom: 30px;
    }
    .overlay .big-emoji {
      font-size: 80px;
      margin-bottom: 16px;
    }
    .overlay .win-text {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 8px;
    }
    .overlay .win-stats {
      font-size: 16px;
      color: #8899bb;
      margin-bottom: 24px;
      text-align: center;
      line-height: 1.8;
    }
    .play-btn {
      padding: 16px 48px;
      font-size: 24px;
      font-weight: 800;
      border: none;
      border-radius: 16px;
      background: linear-gradient(135deg, #7ED957, #56C1FF);
      color: #1a1a2e;
      cursor: pointer;
      box-shadow: 0 6px 24px rgba(126,217,87,0.3);
      transition: transform 0.15s;
    }
    .play-btn:hover { transform: scale(1.06); }
    .play-btn:active { transform: scale(0.97); }
  </style>
</head>
<body>

<!-- START SCREEN -->
<div class="overlay" id="startScreen">
  <div class="big-emoji">&#x1F694;</div>
  <h1>Cops & Robbers</h1>
  <div class="subtitle">Type fast to catch the robber!</div>
  <button class="play-btn" id="startBtn">Start Chase!</button>
</div>

<!-- WIN SCREEN -->
<div class="overlay hidden" id="winScreen">
  <div class="big-emoji">&#x1F6A8;</div>
  <div class="win-text" style="color:#7ED957;">You caught the robber!</div>
  <div class="win-stats" id="winStats"></div>
  <button class="play-btn" id="playAgainBtn">Chase Again!</button>
</div>

<!-- GAME -->
<div class="scene" id="scene">
  <div class="buildings" id="buildings"></div>
  <div class="road-lines" id="roadLines">
    <span></span><span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span><span></span><span></span>
  </div>
  <div class="char cop" id="cop">
    <div class="label">&#x1F46E; YOU</div>
    &#x1F694;
  </div>
  <div class="char robber" id="robber">
    <div class="label">&#x1F3C3; ROBBER</div>
    &#x1F4B0;
  </div>
  <div class="siren" id="siren"></div>
</div>

<div class="meter-area">
  <div class="meter-label">
    <span>Distance to robber</span>
    <span id="distLabel">far away</span>
  </div>
  <div class="meter-bar">
    <div class="meter-fill" id="meterFill"></div>
  </div>
</div>

<div class="game-area">
  <div class="stats">
    <div class="stat">Words: <b id="wordCount">0</b></div>
    <div class="stat">Speed: <b id="wpm">0</b> WPM</div>
    <div class="stat">Streak: <b id="streakCount">0</b></div>
  </div>

  <div class="word-display" id="wordDisplay"></div>

  <div class="input-area">
    <input type="text" class="type-input" id="typeInput" autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false" placeholder="type here...">
  </div>

  <div class="message" id="message">&nbsp;</div>
</div>

<script>
// Age-appropriate words for an 8-year-old, grouped by difficulty
const easyWords = [
  "cat", "dog", "run", "sun", "big", "red", "hat", "cup", "map", "pig",
  "bat", "sit", "hop", "fun", "net", "bed", "box", "fox", "mix", "zip",
  "top", "hot", "jam", "van", "bus", "pen", "ten", "leg", "egg", "mud"
];
const medWords = [
  "jump", "fast", "hero", "city", "gold", "bang", "cash", "dash", "plan",
  "stop", "trap", "team", "safe", "hide", "find", "lock", "mask", "hunt",
  "clue", "grab", "road", "gate", "wall", "risk", "dark", "zoom", "exit",
  "sack", "loud", "glow", "flag", "lamp", "bank", "ring", "slam", "bolt"
];
const hardWords = [
  "chase", "catch", "thief", "money", "guard", "speed", "quick", "sneak",
  "alarm", "badge", "siren", "vault", "heist", "crime", "swipe", "dodge",
  "steal", "crash", "blast", "flash", "escape", "police", "robber",
  "bandit", "danger", "search", "patrol", "busted", "freeze", "arrest",
  "caught", "sprint", "getaway", "suspect", "justice"
];

const GAP_START = 100;       // starting gap (robber ahead)
const GAP_CAUGHT = 0;        // win when gap hits 0
const ROBBER_DRIFT = 0.8;    // robber slowly pulls away per second
const BOOST_EASY = 6;
const BOOST_MED = 9;
const BOOST_HARD = 13;
const STREAK_BONUS = 2;      // extra boost per streak tier (3, 6, 9...)
const SPEED_BONUS_THRESHOLD = 40; // WPM above this gives extra boost
const PENALTY = 4;            // gap increases on skip/timeout

let gap, wordsTyped, streak, bestStreak, startTime, currentWord, currentDifficulty;
let currentBoost, gameActive, wordStartTime, sirenInterval, totalCharsTyped;
let audioCtx;

function ensureAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  if (audioCtx.state === 'suspended') audioCtx.resume();
}

function playNote(freq, type, start, dur, vol) {
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type;
  o.frequency.value = freq;
  g.gain.setValueAtTime(vol || 0.2, start);
  g.gain.exponentialRampToValueAtTime(0.001, start + dur);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(start); o.stop(start + dur);
}

function playType() {
  ensureAudio();
  playNote(800, 'sine', audioCtx.currentTime, 0.05, 0.08);
}

function playWordComplete() {
  ensureAudio();
  const t = audioCtx.currentTime;
  playNote(523, 'triangle', t, 0.15, 0.15);
  playNote(659, 'triangle', t + 0.08, 0.15, 0.15);
  playNote(784, 'triangle', t + 0.16, 0.2, 0.15);
}

function playStreakSound() {
  ensureAudio();
  const t = audioCtx.currentTime;
  playNote(660, 'triangle', t, 0.1, 0.15);
  playNote(880, 'triangle', t + 0.1, 0.1, 0.15);
  playNote(1100, 'triangle', t + 0.2, 0.2, 0.18);
}

function playCaughtSound() {
  ensureAudio();
  const t = audioCtx.currentTime;
  // siren fanfare
  for (let i = 0; i < 6; i++) {
    playNote(i % 2 === 0 ? 880 : 660, 'triangle', t + i * 0.12, 0.15, 0.2);
  }
  playNote(1047, 'triangle', t + 0.8, 0.5, 0.25);
}

function playError() {
  ensureAudio();
  playNote(200, 'square', audioCtx.currentTime, 0.2, 0.1);
}

function pickWord() {
  const roll = Math.random();
  let pool, diff, boost;
  if (roll < 0.35) {
    pool = easyWords; diff = 'easy'; boost = BOOST_EASY;
  } else if (roll < 0.75) {
    pool = medWords; diff = 'medium'; boost = BOOST_MED;
  } else {
    pool = hardWords; diff = 'hard'; boost = BOOST_HARD;
  }
  const word = pool[Math.floor(Math.random() * pool.length)];
  return { word, diff, boost };
}

function renderWord(typed) {
  const display = document.getElementById('wordDisplay');
  display.innerHTML = '';
  for (let i = 0; i < currentWord.length; i++) {
    const span = document.createElement('span');
    span.className = 'letter';
    span.textContent = currentWord[i];
    if (i < typed.length) {
      span.classList.add(typed[i] === currentWord[i] ? 'typed' : 'error');
    } else if (i === typed.length) {
      span.classList.add('current');
    }
    display.appendChild(span);
  }
}

function updateScene() {
  // gap goes from GAP_START (100) to 0
  // cop position: starts at 10%, moves right as gap shrinks
  // robber position: stays around 75-80%
  const progress = 1 - (gap / GAP_START);
  const copLeft = 10 + progress * 62; // 10% -> 72%
  document.getElementById('cop').style.left = copLeft + '%';

  // meter
  const pct = Math.max(0, Math.min(100, progress * 100));
  document.getElementById('meterFill').style.width = pct + '%';

  // distance label
  const distLabel = document.getElementById('distLabel');
  if (pct > 85) distLabel.textContent = 'almost there!';
  else if (pct > 60) distLabel.textContent = 'closing in!';
  else if (pct > 35) distLabel.textContent = 'getting closer';
  else distLabel.textContent = 'far away';

  // road animation
  const road = document.getElementById('roadLines');
  if (gameActive) road.classList.add('running');
  else road.classList.remove('running');
}

function updateStats() {
  document.getElementById('wordCount').textContent = wordsTyped;
  document.getElementById('streakCount').textContent = streak;

  // WPM: chars typed / 5 = "words", divided by minutes elapsed
  const elapsed = (Date.now() - startTime) / 60000;
  const wpm = elapsed > 0 ? Math.round((totalCharsTyped / 5) / elapsed) : 0;
  document.getElementById('wpm').textContent = wpm;
  return wpm;
}

function showMessage(text, cls) {
  const el = document.getElementById('message');
  el.textContent = text;
  el.className = 'message ' + cls;
  setTimeout(() => { el.innerHTML = '&nbsp;'; el.className = 'message'; }, 1200);
}

function nextWord() {
  const pick_ = pickWord();
  currentWord = pick_.word;
  currentDifficulty = pick_.diff;
  currentBoost = pick_.boost;
  wordStartTime = Date.now();
  const input = document.getElementById('typeInput');
  input.value = '';
  renderWord('');
}

function wordCompleted() {
  const wpm = updateStats();

  // Calculate boost
  let boost = currentBoost;

  // Streak bonus
  const streakTier = Math.floor(streak / 3);
  boost += streakTier * STREAK_BONUS;

  // Speed bonus
  if (wpm > SPEED_BONUS_THRESHOLD) {
    boost += Math.floor((wpm - SPEED_BONUS_THRESHOLD) / 10) * 2;
  }

  gap = Math.max(GAP_CAUGHT, gap - boost);
  updateScene();

  // Feedback
  if (streak > 0 && streak % 3 === 0) {
    playStreakSound();
    showMessage('STREAK x' + streak + '! +' + boost + ' boost!', 'great');
  } else if (wpm > SPEED_BONUS_THRESHOLD) {
    playWordComplete();
    showMessage('Speed boost! +' + boost, 'great');
  } else {
    playWordComplete();
    const msgs = ['Nice!', 'Got it!', 'Keep going!', 'Good!'];
    showMessage(msgs[Math.floor(Math.random() * msgs.length)] + ' +' + boost, 'good');
  }

  // Check win
  if (gap <= GAP_CAUGHT) {
    winGame();
    return;
  }

  nextWord();
}

function winGame() {
  gameActive = false;
  clearInterval(sirenInterval);
  document.getElementById('roadLines').classList.remove('running');

  playCaughtSound();

  const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
  const wpm = updateStats();
  const statsEl = document.getElementById('winStats');
  statsEl.innerHTML =
    'Words typed: <b style="color:#fff">' + wordsTyped + '</b><br>' +
    'Best streak: <b style="color:#FFD700">' + bestStreak + '</b><br>' +
    'Top speed: <b style="color:#56C1FF">' + wpm + ' WPM</b><br>' +
    'Time: <b style="color:#fff">' + elapsed + 's</b>';

  document.getElementById('winScreen').classList.remove('hidden');

  // Move cop on top of robber
  document.getElementById('cop').style.left = '72%';
}

function robberDrift() {
  if (!gameActive) return;
  gap = Math.min(GAP_START, gap + ROBBER_DRIFT);
  updateScene();
}

function flashSiren() {
  const siren = document.getElementById('siren');
  siren.className = 'siren flash-red';
  setTimeout(() => { siren.className = 'siren flash-blue'; }, 300);
  setTimeout(() => { siren.className = 'siren'; }, 600);
}

function generateBuildings() {
  const container = document.getElementById('buildings');
  container.innerHTML = '';
  const colors = ['#2a3a5a', '#3a4a6a', '#1e2e4e', '#2e3e5e', '#344a6a'];
  for (let i = 0; i < 14; i++) {
    const b = document.createElement('div');
    b.className = 'building';
    const h = 30 + Math.random() * 70;
    b.style.height = h + 'px';
    b.style.background = colors[Math.floor(Math.random() * colors.length)];
    // windows
    const wins = Math.floor(h / 18);
    for (let w = 0; w < wins; w++) {
      const win = document.createElement('div');
      win.style.cssText = 'width:6px;height:6px;background:' +
        (Math.random() > 0.4 ? 'rgba(255,220,100,0.7)' : 'rgba(100,100,140,0.3)') +
        ';margin:4px auto;border-radius:1px;';
      b.appendChild(win);
    }
    container.appendChild(b);
  }
}

function startGame() {
  gap = GAP_START;
  wordsTyped = 0;
  streak = 0;
  bestStreak = 0;
  totalCharsTyped = 0;
  startTime = Date.now();
  gameActive = true;

  document.getElementById('startScreen').classList.add('hidden');
  document.getElementById('winScreen').classList.add('hidden');
  document.getElementById('cop').style.left = '10%';

  generateBuildings();
  updateScene();
  updateStats();
  nextWord();

  document.getElementById('typeInput').focus();

  // Robber slowly drifts away
  if (sirenInterval) clearInterval(sirenInterval);
  sirenInterval = setInterval(() => {
    robberDrift();
    flashSiren();
  }, 2000);
}

// Input handling
const input = document.getElementById('typeInput');
input.addEventListener('input', () => {
  if (!gameActive) return;
  const val = input.value.toLowerCase();
  renderWord(val);

  if (val.length > 0) playType();

  // Check for errors
  let hasError = false;
  for (let i = 0; i < val.length; i++) {
    if (i >= currentWord.length || val[i] !== currentWord[i]) {
      hasError = true;
      break;
    }
  }

  if (hasError) {
    input.classList.add('error-flash');
    setTimeout(() => input.classList.remove('error-flash'), 200);
  }

  // Word completed correctly
  if (val === currentWord) {
    wordsTyped++;
    streak++;
    if (streak > bestStreak) bestStreak = streak;
    totalCharsTyped += currentWord.length;
    wordCompleted();
  }
});

// Skip word on space (penalty)
input.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && gameActive) {
    // skip word with penalty
    streak = 0;
    gap = Math.min(GAP_START, gap + PENALTY);
    updateScene();
    updateStats();
    playError();
    showMessage('Skipped! Robber pulls ahead...', 'miss');
    nextWord();
  }
});

// Prevent losing focus on mobile
input.addEventListener('blur', () => {
  if (gameActive) setTimeout(() => input.focus(), 100);
});

// Start buttons
document.getElementById('startBtn').addEventListener('click', () => {
  ensureAudio();
  startGame();
});
document.getElementById('playAgainBtn').addEventListener('click', () => {
  ensureAudio();
  startGame();
});
</script>
</body>
</html>
